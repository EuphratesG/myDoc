# 深度学习相关的延伸


## 什么是vllm？
vLLM 是一种旨在优化大语言模型（LLM）推理性能的高效推理引擎，专注于解决传统 LLM 推理过程中内存管理低效的问题，从而实现更快的推理速度和更低的硬件资源消耗。
PagedAttention 是 vLLM 中的核心技术，专门设计用于优化大语言模型（LLM）推理时的内存管理。它通过引入“分页”的动态内存管理机制，有效解决了传统方法中 Key-Value (KV) 缓存分配的低效问题。

注意gpt单decoder的结构是把cross-attention的模块去掉了的，只有masked-attention和FFN。为什么要kv cache？训练的时候没有，因为训练的时候基于teacher-forcing，每次都是给所有的上下文。推理的时候自回归迭代，才需要kvcache。注意大模型推理分两个阶段，第一个是解析prompt并保存kv cache和产生第一个token，第二个阶段每个循环只会输入一个新生成的token提供q，而把新token的kv计算出来之后再和kv cache并在一起做attention。因此为什么没有q cache就知道了，因为没必要啊只有当前一个q。  

PagedAttention 是一种高效管理 Key-Value Cache 的机制，它将缓存分块存储在内存和磁盘之间，适配长序列生成场景。以下通过一个具体实例，说明 PagedAttention 如何在推理中高效利用缓存生成 Token。

---

### **场景描述**
#### **任务：生成故事文本**  
Prompt:  
`"Once upon a time in a faraway land, a young prince named Arin"`

目标：基于这个 Prompt，生成后续 Token。假设序列长度非常长，超出 GPU 内存的直接缓存能力。

#### **挑战**  
- 当前模型序列长度 \(L = 50,000\)（每个 Token 的 Key 和 Value 是 \(d=16,384\) 维）。  
- 如果全缓存，KV Cache 大小为 \(L \times d \times 2 = 50,000 \times 16,384 \times 2 \approx 1.6\ \text{GB}\)。
- 单 GPU 显存不够，PagedAttention 引入分块管理缓存。


### **PagedAttention 的优势**
1. **动态内存管理**：通过分页机制，将长序列的 Key 和 Value 缓存分为活跃页（存储于 GPU）和非活跃页（存储于 CPU 或磁盘），显著降低显存需求。
2. **上下文扩展能力强**：即使序列长度达到百万级，也可以通过分块管理确保模型可以高效访问全部上下文。
3. **按需调度**：仅在需要时加载非活跃页，减少不必要的数据传输和计算。

PagedAttention 的这种优化对于大模型长序列推理尤为重要，既保证了内存效率，又提供了生成时的上下文完整性。



## gbdt是什么
Gradient Boosting Decision Tree，梯度提升决策树  
属于提升算法（Boosting）的一种。它通过逐步构建多个决策树，并结合每个树的预测结果来提高模型的准确性。GBDT的核心思想是通过优化目标函数（通常是损失函数）来减少误差，并在每一步迭代中使用梯度下降来修正前一轮预测的残差。

## moe
研究低算力slm 产生的灵感，我或许不需要那么多领域的覆盖，所以研究混合专家，做有限领域垂直应用。就好比人类社会，各有分工，简洁明了。  
同时直观想法横向拓展参数量，理论上就应该有提升。  
如何提升MOE并行的效率，专家之间的网络通信会成为计算的瓶颈。而且GPU擅长做矩阵运算，不擅长做分支；每个专家小模型分配的样本数较少，无法得到充分的训练；（是否可以先训练出若干个完整的大模型，例如数学大模型、代码大模型、问答大模型等，然后作为专家的初始化？）需要确保专家模型上的负载均衡

其实就是把attention的ffn换成多个网络（可以是ffn，也可以是别的所有）  
训练和推理的时候在前面加一个gate（router，也是ffn），同时设定超参数topk决定有几个专家加入推理。  
LLM用“MoE”这个词很误导人，和之前推荐系统中的MoE根本不是一回事。LLM用的这个技术准确点应该叫做SMoE。

.推荐系统中的专家是真的专家，每个专家都有特定的功能（一般是每个专家负责输入一个子业务，或者预测一个业务目标）。而LLM各“专家”都是自动学出来的，并没有什么实质的区别。实验发现，从模型中删掉一两个“专家”，也不会使模型发生质的变化，只是效果稍差一点；
推荐系统中的MoE，一般是各个专家都会计算，最后加权求和，并不能节省计算量。而LLM中一般只激活部分“专家”。  

感觉计算中的中间向量结果其实都可以理解成概率，只是需要softmax去归一化罢了（例如上面所说的router的输出就是token数、选专家的概率）  


## 基于梯度下降法的模型训练的源头
深度学习框架帮我们解决了哪些问题？其实用numpy也能实现前向反向传播，但是速度和效率都不行，且不能使用gpu加速。
```python
np.random.seed(0)

N, D = 3, 4

x = np.random.randn(N, D) 
```  
深度学习框架，帮助我们解决的核心问题就是反向传播时的梯度计算和更新，当然，它们的功能远不止这些，像各种方便的loss函数:交叉熵，MSE均方损失...；各种优化器：sgd,adam...;GPU并行计算加速等；模型的保存恢复可视化等等。(没说前向传播的原因是前向传播逻辑实际上写在了网络类里面了)  



## CoT_chain_of_thought

我先放个在这里，预训练可能会用到。
* 人工Few-shot CoT 人工直接给样例回答
* auto zero-shot CoT 只说step by step
  * auto auto-CoT 把上面的结果当做样例





## 面试题
用语言介绍一下Transformer的整体流程 
深度学习的三种并行方式：数据并行，模型并行，流水线并行 
Deepspeed分布式训练的了解，zero 0-3的了解。 
对于CLIP的了解 
说几种对比学习的损失函数，以及它们的特点和优缺点 
说说大模型生成采样的几种方式，它们的特点和优缺点比较 
损失函数中温度的作用 
BLIP的细节。（面试中提的问题是BLIP为什么将训练分成两个阶段） 
Visual Encoder有哪些常见的类型？ 
深度学习中常用的优化器有哪些？ 
SimCSE的了解 
prenorm和postnorm 
LLaMA 2的创新/ChatGLM的创新点/Qwen的创新点/Baichuan的创新点 
LLM的评估方式有哪些？特点是什么？（中文的呢？） 
文本生成模型中生成参数的作用（temperature，top p, top k，num beams） 
LoRA的作用和原理 
CoT的作用 
神经网络经典的激活函数以及它们的优缺点 
softmax函数求导的推导 
BERT的参数量如何计算？ 
AUC和ROC 
batch norm和layer norm 
大模型训练的超参数设置 
经典的词向量模型有哪些？ 
InstructGPT三个阶段的训练过程，用语言描述出来（过程，损失函数） 
大模型推理加速的方法 
Transformer中注意力的作用是什么 
RNN、CNN和Transformer的比较（复杂度，特点，适用范围etc） 
AC自动机 
产生梯度消失问题的原因有哪些？ 
大模型的幻觉问题 
大模型训练数据处理 
RLHF的计算细节 
构建CoT样本的时候，怎么保证覆盖不同的场景？ 
召回的三个指标：Recall、NDCG、RMSE 
RoPE和ALiBi 
交叉熵、NCE和InfoNCE的区别和联系 
贝叶斯学派和概率学派的区别 
一个文件的大小超过了主存容量，如何对这个文件进行排序？应该使用什么算法？ 
Python中的线程、进程和协程 
python中的生成器和迭代器
1.简历中论文课题
2.adam优化器原理
3.LLama框架和transformer框架的主要区别，以及其中的归一化操作是什么，怎样实现的
4.lora的实现原理，其他微调方法.大语言模型量化、蒸馏、剪枝操作如何实现
5.旋转位置编码的原理
6.手撕多头注意力机制
7.反问